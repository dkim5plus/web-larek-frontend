# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных

Продукт
```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null
}
```

Инфа о заказе
```
interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Корзина
```
interface ICart {
  items: IProduct[];
  total: number;
}
```

Способ оплаты и адрес
```
interface IDelivery {
	payment: string;
  address: string;
}
```

Контактные данные
```
interface IContact {
	email: string;
	phone: string;
}
```

Главная страница
```
interface IPage {
  items: IProduct[];
  counter: number;
}
```

## Архитектура приложения

Код приложения написан в парадигме MVP(Model, View, Presenter)

- Model отвечает за хранение данных;
- View отвечает за отображение данных на странице;
- Presenter связывает модель и отображение.


## Базовые классы

### Api
Отвечает за базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
```
constructor(baseUrl: string, options: RequestInit = {})
```
Методы:
- protected handleResponse - защищенный метод, обрабатывающий ответ от сервера. Возвращает объект в формате JSON при успехе или ошибку при неудаче;
- get - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом ответа от сервера;
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет на эндпоинт, переданный как параметр при вызове метода. 

### EventEmitter
Брокер событий позволяет объектам взаимодействовать друг с другом через события. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Методы:
- on - подиска на событие;
- off - отписка от события;
- emit - инициализация события;
- onAll - подписка на все события;
- offAll - сброс всех подписчиков;
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Component
Абстрактный класс служащий базовым компонентом для остальных компонентов интерфейса. В нем представлен инструментарий для работы с DOM.
Методы:
- toggleClass - переключить класс;
- setText - установить текст элементу;
- setDisabled - переключить статус disabled;
- setHidden - скрыть элемент;
- setVisible - показать элемент;
- setImage - установить изображение с алтернативным текстом;
- render - вернуть корневой DOM-элемент.


## Слой данных
### Класс CardData
Отвечает за получение массива товаров с сервера и его хранение, за логику открытия подробной информации о товаре.
Методы:
- set и get, отвечающие за массив карточек 
- setCardPreview - выбор товара для отображения в модальном окне

### Класс CartData
Хранит данные о товарах, добавленных в корзину, и логику работы с этими данными.
Методы:
- addCart - добавляет товар в корзину 
- removeCart - удаляет товар из корзины  
- getTotal - получает стоимость всей корзины 
- clearCart - очистка корзины
- getCartSize - возвращает количество товара в корзине
- getCartId- получение массива из id товаров в корзине


### Класс OrderData
Отвечает за хранение и логику работы с данными пользователя для оформления заказа.
Методы:
- getOrder - получение данных для заказа
- clearOrder - очистка текущего заказа
- setOrderField - записывает значение в поле заказа 
- validateOrder - валидация полей заказа и установка значений ошибок, если они есть 

### События изменения данных:
- cards:changed - изменение массива карточек;
- card:selected - изменение данных о товаре, который открывается в модальном окне.
- cart:changed - изменение массива товаров;


## Слой представления
Все классы наследуются от класса Component.

### Класс Page
Отвечает за отображение главной страницы.
Методы:
- set counter - устанавливает количество товаров в корзине;
- set catalog - устанавливает каталог товаров;
- set block - устанавливает блокировку страницы при открытии модалки.

### Класс Card
Отображает и управляет карточками товаров. 
Методы:
- сеттеры для заполнения элементов карточки;
- get id - получение id товара;
- set id - установка значения в поле 'id'

### Класс Modal
Отвечает за работу с модальными окнами.
Методы:
- open - открывает модальное окно 
- close - закрывает модальное окно 
- set content - меняет содержимое модального окна

### Класс Cart
Отвечает за работу с корзиной.
Методы
- set total - отображает общую стоимость выбранных товаров;
- set selectedList - отображает выбранные товары.

### Класс Form
Отвечает за работу с формами.
Методы:
- inputChange - обработчик для изменения ввода;
- set valid - устанавливает проверку формы;
- set errors - устанавливает сообщения об ошибках;
- render - рендерит элементы формы.

### Класс FormDelivery
Для работы с формой доставки. Наследуется от класса Form.
Методы:
- set address - отображает значения поля адрес;
- set payment - отображает значение оплаты.

### Класс FormContact
Для работы с формой контактов. Наследуется от класса Form.
Методы:
- set phone - отображает значениев поля телефон;
- set email - отображает значение поля email.

### Класс EndModal
Для работы с модалкой уведомления о заказе.
Методы:
- set total - отображает итоговую стоимость заказа.


### События, возникающие при взаимодействии пользователя с интерфейсом:
- card:open - открытие модалки с карточкой товара;
- card:close - закрытие модалки с карточкой товара;
- cart:open - открытие модалки корзины;
- cart:close - закрытие модалки корзины;
- adress:input - изменение данных в форме с вводом адреса;
- email:input - изменение данных в форме с вводом почты;
- phone:input - изменение данных в форме с вводом телефона;
- delivery:submit - отправка формы с адресом;
- contact:submit - отправка формы с контактами пользователя;
- end:close - закрытие модалки уведомления об успешных покупках.

## Взаимодействие компонентов

При нажатии на карточку товара класс представления Card реагирует на пользователя и генерируется событие "card:selected".
Далее Presenter считывает событие и вызывает метод getCardPreview из модели CardData, чтобы получить данные о товаре.
После получения данных о товаре, Presenter передает эти данные в класс представления Modal, который отвечает за отображение модального окна. 
Метод open в классе Modal используется для открытия окна, а set content — для заполнения его содержимым.